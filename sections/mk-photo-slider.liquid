{{ 'swiper@12.min.css' | asset_url | stylesheet_tag }}
<script
  src="{{ 'swiper@12.min.js' | asset_url }}"
  defer="defer"
></script>

<div class="mk-photo-slider mk-container">
  <div class="mk-photo-slider-header">
    <h2 class="text-{{ section.settings.title_size_pc }} md:text-{{ section.settings.title_size_mobile }}">{{ section.settings.title }}</h2>
  </div>
  <div class="mk-photo-slider-content">
    <div class="mk-photo-slider-content-left">
      {% if section.blocks.size > 0 %}
        {% for block in section.blocks %}
          <div
            class="mk-photo-slider-content-item-content {% if forloop.first %}active{% endif %}"
            data-index="{{ forloop.index0 }}"
          >
            <h3 class="text-{{ block.settings.title_size_pc }} md:text-{{ block.settings.title_size_mobile }}">{{ block.settings.title }}</h3>
            <p class="text-16 md:text-14">{{ block.settings.description }}</p>
            {% if block.settings.button_text != blank %}
              <a
                href="{{ block.settings.link }}"
                class="mk-photo-slider-content-item-content-button"
              >
                {{- block.settings.button_text -}}
              </a>
            {% endif %}
          </div>
        {% endfor %}
      {% endif %}
    </div>
    <div class="mk-photo-slider-content-right">
      <div class="swiper mk-photo-slider-swiper">
        <div class="swiper-wrapper">
          {% if section.blocks.size > 0 %}
            {% for block in section.blocks %}
              {% if block.type == 'mk-photo-item' %}
                <div class="swiper-slide mk-photo-slider-slide" {{ block.shopify_attributes }}>
                  <div class="mk-photo-slider-item">
                    {% if block.settings.image != blank %}
                      <img
                        src="{{ block.settings.image | image_url: width: 800 }}"
                        alt="{{ block.settings.alt_text | default: block.settings.image.alt }}"
                        width="800"
                        height="600"
                        loading="lazy"
                        class="mk-photo-slider-image"
                      >
                    {% else %}
                      {{ 'lifestyle-1' | placeholder_svg_tag: 'mk-photo-slider-image' }}
                    {% endif %}
                  </div>
                </div>
              {% endif %}
            {% endfor %}
          {% else %}
            {% for i in (1..5) %}
              <div class="swiper-slide mk-photo-slider-slide">
                <div class="mk-photo-slider-item">
                  {{ 'lifestyle-1' | placeholder_svg_tag: 'mk-photo-slider-image' }}
                </div>
              </div>
            {% endfor %}
          {% endif %}
        </div>
      </div>
    </div>
    <div class="mk-photo-slider-navigation">
      <div class="swiper-button-prev mk-photo-slider-button-prev">
        {{ 'icon-left.svg' | inline_asset_content }}
      </div>
      <div class="swiper-button-next mk-photo-slider-button-next">
        {{ 'icon-right.svg' | inline_asset_content }}
      </div>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "MK Photo Slider",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title"
    },
    {
      "type": "select",
      "id": "title_size_pc",
      "label": "Title Size PC",
      "options": [
        {
          "value": "16",
          "label": "16"
        },
        {
          "value": "18",
          "label": "18"
        },
        {
          "value": "20",
          "label": "20"
        },
        {
          "value": "22",
          "label": "22"
        },
        {
          "value": "24",
          "label": "24"
        },
        {
          "value": "28",
          "label": "28"
        },
        {
          "value": "32",
          "label": "32"
        },
        {
          "value": "36",
          "label": "36"
        },
        {
          "value": "40",
          "label": "40"
        },
        {
          "value": "48",
          "label": "48"
        }
      ],
      "default": "48"
    },
    {
      "type": "select",
      "id": "title_size_mb",
      "label": "Title Size Mobile",
      "options": [
        {
          "value": "14",
          "label": "14"
        },
        {
          "value": "16",
          "label": "16"
        },
        {
          "value": "18",
          "label": "18"
        },
        {
          "value": "20",
          "label": "20"
        },

        {
          "value": "22",
          "label": "22"
        },
        {
          "value": "24",
          "label": "24"
        },
        {
          "value": "28",
          "label": "28"
        },
        {
          "value": "32",
          "label": "32"
        },
        {
          "value": "36",
          "label": "36"
        },
        {
          "value": "40",
          "label": "40"
        },
        {
          "value": "48",
          "label": "48"
        }
      ],
      "default": "32"
    },
  ],
  "blocks": [
    {
      "type": "mk-photo-item",
      "name": "MK Photo Item",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "alt_text",
          "label": "Alt Text",
          "info": "SEO"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title"
        },
        {
          "type": "select",
          "id": "title_size_pc",
          "label": "Title Size PC",
          "options": [
            {
              "value": "16",
              "label": "16"
            },
            {
              "value": "18",
              "label": "18"
            },
            {
              "value": "20",
              "label": "20"
            },
            {
              "value": "22",
              "label": "22"
            },
            {
              "value": "24",
              "label": "24"
            },
            {
              "value": "28",
              "label": "28"
            },
            {
              "value": "32",
              "label": "32"
            },
            {
              "value": "36",
              "label": "36"
            },
            {
              "value": "40",
              "label": "40"
            },
            {
              "value": "48",
              "label": "48"
            }
          ],
          "default": "32"
        },
        {
          "type": "select",
          "id": "title_size_mb",
          "label": "Title Size Mobile",
          "options": [
            {
              "value": "14",
              "label": "14"
            },
            {
              "value": "16",
              "label": "16"
            },
            {
              "value": "18",
              "label": "18"
            },
            {
              "value": "20",
              "label": "20"
            },
    
            {
              "value": "22",
              "label": "22"
            },
            {
              "value": "24",
              "label": "24"
            },
            {
              "value": "28",
              "label": "28"
            },
            {
              "value": "32",
              "label": "32"
            },
            {
              "value": "36",
              "label": "36"
            },
            {
              "value": "40",
              "label": "40"
            },
            {
              "value": "48",
              "label": "48"
            }
          ],
          "default": "20"
        },
        {
          "type": "text",
          "id": "description",
          "label": "Description"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "Button Text"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "MK Photo Slider"
    }
  ]
}
{% endschema %}

<style>
  .mk-photo-slider {
    width: 100%;
    box-sizing: border-box;
    padding: 40px 20px;
  }

  .mk-photo-slider-header {
    text-align: center;
    margin-bottom: 40px;
  }

  .mk-photo-slider-header h2 {
    color: #333;
    margin: 0;
  }

  .mk-photo-slider-content {
    display: flex;
    align-items: center;
    gap: 40px;
    position: relative;
    width: 100%;
  }

  .mk-photo-slider-content-left {
    flex-basis: 40%;
    position: relative;
  }

  .mk-photo-slider-content-item-content {
    display: none;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .mk-photo-slider-content-item-content.active {
    display: block;
    opacity: 1;
  }

  .mk-photo-slider-content-item-content h3 {
    margin-bottom: 20px;
    color: #333;
  }

  .mk-photo-slider-content-item-content p {
    color: #666;
    margin-bottom: 20px;
  }

  .mk-photo-slider-content-item-content-button {
    display: inline-block;
    padding: 12px 24px;
    background-color: #333;
    color: white;
    text-decoration: none;
    border-radius: 8px;
    transition: all 0.3s;
  }

  .mk-photo-slider-content-item-content-button:hover {
    background-color: #555;
  }

  .mk-photo-slider-content-right {
    flex-basis: 60%;
    position: relative;
  }

  .mk-photo-slider-swiper {
    position: relative;
    overflow: hidden;
    width: 100%;
  }

  .mk-photo-slider-swiper .swiper-wrapper {
    position: relative;
    width: 100%;
    height: 100%;
  }

  .mk-photo-slider-swiper .swiper-slide {
    width: 80%;
    height: auto;
    aspect-ratio: 4/3;
    border-radius: 16px;
    overflow: hidden;
  }

  .mk-photo-slider-item {
    position: relative;
    width: 100%;
    height: 100%;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
  }

  .mk-photo-slider-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    background: rgb(82, 82, 82);
  }

  .mk-photo-slider-navigation {
    position: absolute;
    bottom: 0;
    left: 0px;
    display: flex;
    gap: 12px;
    z-index: 10;
  }

  .mk-photo-slider-navigation .mk-photo-slider-button-prev,
  .mk-photo-slider-navigation .mk-photo-slider-button-next {
    width: 40px;
    height: 40px;
    background-color: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.12), 0 2px 8px rgba(0, 0, 0, 0.08);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    border: 1px solid rgba(0, 0, 0, 0.05);
    color: #333;
  }
  .mk-photo-slider-navigation .mk-photo-slider-button-prev svg,
  .mk-photo-slider-navigation .mk-photo-slider-button-next svg {
    width: 20px;
    height: 20px;
  }

  .mk-photo-slider-navigation .mk-photo-slider-button-prev:hover,
  .mk-photo-slider-navigation .mk-photo-slider-button-next:hover {
    background-color: rgba(255, 255, 255, 1);
    transform: translateY(-2px) scale(1.05);
    box-shadow: 0 6px 24px rgba(0, 0, 0, 0.16), 0 4px 12px rgba(0, 0, 0, 0.12);
  }

  .mk-photo-slider-navigation .mk-photo-slider-button-prev.swiper-button-disabled,
  .mk-photo-slider-navigation .mk-photo-slider-button-next.swiper-button-disabled {
    opacity: 0.4;
    cursor: not-allowed;
    pointer-events: none;
  }

  /* 响应式设计 */
  @media (max-width: 768px) {
    .mk-photo-slider-content {
      flex-direction: column;
      gap: 20px;
    }

    .mk-photo-slider-content-left {
      flex-basis: 100%;
      text-align: center;
    }

    .mk-photo-slider-content-right {
      flex-basis: 100%;
      width: 100%;
    }

    .mk-photo-slider-swiper .swiper-slide {
      width: auto;
      aspect-ratio: 4 / 3;
    }

    .mk-photo-slider-item {
      box-shadow: none;
    }

    .mk-photo-slider-image {
      border-radius: 16px;
    }

    .mk-photo-slider-navigation {
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
    }

    .mk-photo-slider-navigation .mk-photo-slider-button-prev,
    .mk-photo-slider-navigation .mk-photo-slider-button-next {
      width: 48px;
      height: 48px;
    }

    .mk-photo-slider-navigation .mk-photo-slider-button-prev svg,
    .mk-photo-slider-navigation .mk-photo-slider-button-next svg {
      width: 18px;
      height: 18px;
    }
  }
</style>

<script>
  (function () {
    let mkPhotoSliderSwiperInstance = null;
    const breakpoint = window.matchMedia('(max-width: 768px)');

    const desktopConfig = {
      effect: 'cards',
      grabCursor: true,
      centeredSlides: true,
      slidesPerView: 'auto',
      loop: true,
      loopAdditionalSlides: 2,
      loopedSlides: 2,
      initialSlide: 0,
      watchSlidesProgress: true,
      navigation: {
        nextEl: '.mk-photo-slider-button-next',
        prevEl: '.mk-photo-slider-button-prev',
      },
      cardsEffect: {
        rotate: true,
        perSlideOffset: 12,
        perSlideRotate: 2,
        slideShadows: true,
      },
      on: {
        init: function () {
          // 确保初始化时显示第一个内容
          updateContent(this.realIndex);
          // 确保按钮状态正确
          const self = this;
          requestAnimationFrame(function() {
            self.update();
            self.updateSlidesClasses();
          });
        },
        slideChange: function () {
          updateContent(this.realIndex);
        },
      },
    };

    const mobileConfig = {
      effect: 'slide',
      grabCursor: true,
      centeredSlides: false,
      slidesPerView: 1.1,
      spaceBetween: 16,
      loop: true,
      loopAdditionalSlides: 2,
      initialSlide: 0,
      watchSlidesProgress: true,
      navigation: {
        nextEl: '.mk-photo-slider-button-next',
        prevEl: '.mk-photo-slider-button-prev',
      },
      on: {
        init: function () {
          // 确保初始化时显示第一个内容
          updateContent(this.realIndex);
          // 确保按钮状态正确
          const self = this;
          requestAnimationFrame(function() {
            self.update();
            self.updateSlidesClasses();
          });
        },
        slideChange: function () {
          updateContent(this.realIndex);
        },
      },
    };

    function updateContent(index) {
      const contentItems = document.querySelectorAll('.mk-photo-slider-content-item-content');
      contentItems.forEach((item, i) => {
        item.classList.remove('active');
        if (i === index) {
          item.classList.add('active');
        }
      });
    }

    function initMkPhotoSliderSwiper() {
      if (typeof Swiper === 'undefined') {
        setTimeout(initMkPhotoSliderSwiper, 100);
        return;
      }

      if (mkPhotoSliderSwiperInstance) {
        mkPhotoSliderSwiperInstance.destroy(true, true);
      }

      const config = breakpoint.matches ? mobileConfig : desktopConfig;
      mkPhotoSliderSwiperInstance = new Swiper('.mk-photo-slider-swiper', config);
    }

    document.addEventListener('DOMContentLoaded', function () {
      initMkPhotoSliderSwiper();
      breakpoint.addEventListener('change', initMkPhotoSliderSwiper);
    });
  })();
</script>
